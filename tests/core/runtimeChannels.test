----------------------------------------------------------------------------------------------------
# Channel identity

-- <>

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

<Channel>

----------------------------------------------------------------------------------------------------
# Task channel identity

task()
    _

-- task..()

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

<Channel>

----------------------------------------------------------------------------------------------------
# Task channel timing

task()
    -- "during"

-- "before"
-- task..()
-- "after"

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

before
during
<Channel>
after

----------------------------------------------------------------------------------------------------
# Task channel timing

task(a)
    -- "got %a"

task..(1)
-- "after"

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

got 1
after

----------------------------------------------------------------------------------------------------

a = 1
a..()

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

Exception: Object can not be called as new task.
<no file>, line 2, in <source>

----------------------------------------------------------------------------------------------------
# Write and do not wait

task(inputs)
    read = -> inputs
    -- "got %read"

outputs = <>
outputs <<< 1
-- "wrote 1"
task..(outputs)

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

wrote 1
got 1

----------------------------------------------------------------------------------------------------
# Enqueued messages are read in first-in-first-out order

task(inputs)
    read = -> inputs
    -- "got %read"
    read = -> inputs
    -- "got %read"

outputs = <>
task..(outputs)
outputs <<< 1
-- "wrote 1"
outputs <<< 2
-- "wrote 2"

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

got 1
wrote 1
got 2
wrote 2

----------------------------------------------------------------------------------------------------
# Write and wait for read

task(inputs)
    read = -> inputs
    -- "got %read"

outputs = <>
task..(outputs)
outputs <- "it"
-- "back"

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

got it
back

----------------------------------------------------------------------------------------------------
# Write and wait for read returns undefined

task(inputs)
    read = -> inputs
    -- "got %read"

outputs = <>
task..(outputs)
response = outputs <- "it"
-- "got back %response"

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

got it
got back undefined

----------------------------------------------------------------------------------------------------
# Read and wait for write

task(outputs)
    outputs <- "it"
    -- "back"

inputs = <>
task..(inputs)
read = -> inputs
-- "got %read"

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

got it
back

----------------------------------------------------------------------------------------------------
# Write and wait for response

task(inputs)
    read = -> inputs
    -- "got %read"
    inputs >> "read %read"
    -- "responded"

outputs = <>
task..(outputs)
response = outputs << "it"
-- "got back \"%response\""

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

got it
got back "read it"
responded

----------------------------------------------------------------------------------------------------
# Unexpected response

task(inputs)
    inputs >> 1

outputs = <>
task..(outputs)

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

Exception: Nothing to respond to.
<no file>, line 2, in task

----------------------------------------------------------------------------------------------------
# Basic loop reads

task(outputs)
    outputs <- 1
    outputs <- 2
    outputs.close()

inputs = <>
task..(inputs)

for message in inputs
    -- "read %message"
-- "done"

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

read 1
read 2
done

----------------------------------------------------------------------------------------------------
# Basic loop reads

task(outputs)
    response = outputs << 1
    -- "responded %response"
    response = outputs << 2
    -- "responded %response"
    outputs.close()

inputs = <>
task..(inputs)

for message in inputs
    -- "read %message"
    inputs >> message*5
-- "done"

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

read 1
responded 5
read 2
responded 10
done

----------------------------------------------------------------------------------------------------

1 <- 2

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

Exception: Expected a channel.
<no file>, line 1, in <source>

----------------------------------------------------------------------------------------------------

1 << 2

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

Exception: Expected a channel.
<no file>, line 1, in <source>

----------------------------------------------------------------------------------------------------

1 <<< 2

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

Exception: Expected a channel.
<no file>, line 1, in <source>

----------------------------------------------------------------------------------------------------

1 >> 2

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

Exception: Expected a channel.
<no file>, line 1, in <source>

----------------------------------------------------------------------------------------------------

-> 1

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

Exception: Expected a channel.
<no file>, line 1, in <source>

----------------------------------------------------------------------------------------------------
