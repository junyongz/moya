----------------------------------------------------------------------------------------------------

+ Thing {
    + a = 42
    + b = 99
}

+ main() {
    x = Thing()
    -- x.b
    x.b = 100
    -- x.b
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

99
100

----------------------------------------------------------------------------------------------------

+ Thing {
    + a = b + 1
    + b = 42
}

+ main() {
    x = Thing()
    -- x.a
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

43

----------------------------------------------------------------------------------------------------

+ Thing {
    + a = 42
    + b = a + 1
}

+ main() {
    x = Thing()
    -- x.b
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

43

----------------------------------------------------------------------------------------------------
# Circular property reference

+ Thing {
    + a = b
    + b = a
}

+ main() {
    x = Thing()
    -- x.b
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

Exception: Circular reference to "a"
<no file>, line 2
        + a = b
              ^

----------------------------------------------------------------------------------------------------

+ Thing {
}

+ main() {
    x = Thing()
    -- x.c
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
%mode: ir
Exception: Property "c" not found
<no file>, line 6
        -- x.c
           ^

----------------------------------------------------------------------------------------------------

+ Thing {
}

+ main() {
    x = Thing()
    x.c = 1
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

Exception: Property "c" not found
<no file>, line 6
        x.c = 1
        ^^^

----------------------------------------------------------------------------------------------------

+ main() {
    x = 1
    -- x.c
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

Exception: Property "c" not found
<no file>, line 3
        -- x.c
           ^

----------------------------------------------------------------------------------------------------

+ main() {
    x = 1
    x.c = 1
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

Exception: Property "c" not found
<no file>, line 3
        x.c = 1
        ^^^

----------------------------------------------------------------------------------------------------

+ Thing\T1 {
    + a:T1 = 1.5
}

+ main() {
    t1 = Thing\Double()
    -- t1.a
    t2 = Thing\Int32()
    -- t2.a
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

1.500000
1

----------------------------------------------------------------------------------------------------
# Multiple type parameters

+ Foo\T1\T2 {
    + a:T1 = 1.5
    + b:T2 = 1.5
}

+ main() {
    t = Foo\Double\Int32()
    -- t.a
    -- t.b
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

1.500000
1

----------------------------------------------------------------------------------------------------

+ Thing\T1 {
    + a:T1 = 0
}

+ foo\T(j:Thing\T) {
    x:T = 1.5
    -- x
}

+ main() {
    t1 = Thing\Double()
    foo(t1)
    t2 = Thing\Int32()
    foo(t2)
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

1.500000
1

----------------------------------------------------------------------------------------------------
# Extract type of nested type parameters

+ Foo\T1 {
    + a = 0
}

+ List\T1 {
    + b:T1 = 0
}

+ Map\T1 {
    + b:T1 = 0
}

+ foo\T(j:Foo\(List\T)) {
    x:T = 1.5
    -- x
}

+ main() {
    t = Foo\(List\Double)()
    foo(t)
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

1.500000

----------------------------------------------------------------------------------------------------

+ Thing {
    + a = 0
    
    + This(aa) {
        a = aa
    }
}

+ main() {
    thing = Thing(42)
    -- thing.a
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

42

----------------------------------------------------------------------------------------------------
# Multiple constructors with different argument signatures

+ Thing {
    + a = 0
    
    + This(aa) {
        a = aa
    }

    + This(aa, bb) {
        a = 35
    }
}

+ main() {
    thing = Thing(42, 1)
    -- thing.a
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

35

----------------------------------------------------------------------------------------------------
# Deduce class type arguments from constructor arguments

+ Thing\T {
    + a:T = 0
    
    + This(aa:T) {
        a = aa
    }
}

+ main() {
    thing1 = Thing(42.5)
    -- thing1.a
    thing2 = Thing(42)
    -- thing2.a
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

42.500000
42

----------------------------------------------------------------------------------------------------
# Default value in second argument

+ Thing\T {
    + a:T = 0
    
    + This(aa:T, bb=5) {
        a = aa + bb
    }
}

+ main() {
    thing = Thing(8)
    -- thing.a
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

13

----------------------------------------------------------------------------------------------------
# Two constructors with one argument, but one has default value, choose it when no args passed

+ Thing\T {
    + a:T = 0

    + This(aa:T) {
        a = aa
    }
    
    + This(aa=5) {
        a = aa
    }
}

+ main() {
    thing = Thing\Double()
    -- thing.a
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

5.000000

----------------------------------------------------------------------------------------------------

+ Thing\T {
    + a:T = 0
    
    + This(aa=5) {
        a = aa
    }
}

+ main() {
    thing = Thing()
    -- thing.a
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

Exception: Function "Thing" not found
<no file>, line 10
        thing = Thing()
                ^^^^^

----------------------------------------------------------------------------------------------------

+ Thing\T {
    + a:T = 0
    
    + This(aa=5) {
        a = aa
    }
}

+ main() {
    thing = Thing\Int32()
    -- thing.a
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

5

----------------------------------------------------------------------------------------------------

+ Thing\T {
    + a:T = 0
    
    + This(aa:T=5) {
        a = aa
    }
}

+ main() {
    thing1 = Thing()
    -- thing1.a
    thing2 = Thing(5.5)
    -- thing2.a
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

5
5.500000

----------------------------------------------------------------------------------------------------

+ Thing {
    + a = 0
}

+ main() {
    thing = Thing()
    -- "%thing"
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

Thing

----------------------------------------------------------------------------------------------------

+ Bling {
    + a = 42
}

+ Thing {
    + bling = Bling()
}

+ main() {
    thing = Thing()
    -- thing.bling.a
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

42

----------------------------------------------------------------------------------------------------

+ Thing {
    + a:Int32 = 0
    
    + This() {
        a = 10
    }

    + This(other) {
        a = other
    }
}

+ main() {
    t = Thing()
    -- t.a
    t = Thing(42)
    -- t.a
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

10
42

----------------------------------------------------------------------------------------------------
# Call constructor with type variable

+ Bling {
    + a = 42
}

+ Thing\T {
    + bling:T = T()
}

+ main() {
    thing = Thing\Bling()
    -- thing.bling.a
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

42

----------------------------------------------------------------------------------------------------
# Call constructor with type variable

+ Bling {
    + a = 42
}

+ Thing\T {
    + bling = T()
}

+ main() {
    thing = Thing\Bling()
    -- thing.bling.a
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

42

----------------------------------------------------------------------------------------------------

+ Bling\T {
    + a:T = 42
}

+ Thing\T {
    + bling = T\Double()
}

+ main() {
    thing = Thing\Bling()
    -- thing.bling.a
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

42.000000

----------------------------------------------------------------------------------------------------

+ Bling\T {
    + a:T = 42
}

+ Thing\T\G {
    + bling = T\G()
}

+ main() {
    thing = Thing\Bling\Double()
    -- thing.bling.a
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

42.000000

----------------------------------------------------------------------------------------------------

+ Bling\T {
    + a:T = 42.5
}

+ foo\T(a:T) {
    x = T\Int32()
    -- x.a
}

+ main() {
    thing = Bling\Double()
    -- thing.a
    foo(thing)
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

42.500000
42

----------------------------------------------------------------------------------------------------

+ Bling\T {
    + a:T = 42.5
}

+ foo\T(a:T) {
    x:T\Int32 = T\Int32()
    -- x.a
}

+ main() {
    thing = Bling\Double()
    -- thing.a
    foo(thing)
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

42.500000
42

----------------------------------------------------------------------------------------------------

+ foo() {
    a:Bling = 0
}

+ main() {
    foo()
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

Exception: Type not found
<no file>, line 2
        a:Bling = 0
          ^^^^^

----------------------------------------------------------------------------------------------------

+ foo() {
    a:Bling\T = 0
}

+ main() {
    foo()
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

Exception: Type not found
<no file>, line 2
        a:Bling\T = 0
          ^^^^^

----------------------------------------------------------------------------------------------------

+ main() {
    a = Bling\T()
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

Exception: Type not found
<no file>, line 2
        a = Bling\T()
                  ^

----------------------------------------------------------------------------------------------------
